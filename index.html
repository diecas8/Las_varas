<!DOCTYPE html>
<html>
<head>
    <title>Geoportal Tumaco</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <style>
        html, body, #map { height: 100%; margin: 0; }
        
        /* Barra de control compacta */
        #control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 300px;
        }

        #file-input {
            margin: 5px 0;
        }

        /* Estilo para capas predefinidas */
        .layer-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .color-box {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #control-panel {
                max-width: 90%;
                right: 5%;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Panel de control compacto -->
    <div id="control-panel">
        <input type="file" id="file-input" accept=".geojson,.kml" style="width: 100%">
        
        <div id="layers-list">
            <h4>Capas</h4>
            <div class="layer-item">
                <input type="checkbox" id="tumaco-check" checked>
                <label for="tumaco-check">Tumaco</label>
                <div class="color-box" style="background: #FFA500"></div>
            </div>
            <!-- Más capas predefinidas se agregarán aquí -->
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/omnivore/0.3.4/leaflet-omnivore.min.js"></script>

    <script>
        const map = L.map('map').setView([1.795, -78.825], 10);

        // Capas base
        const googleStreets = L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            subdomains: ['mt0','mt1','mt2','mt3'],
            attribution: 'Google Maps'
        }).addTo(map);

        const esriSatellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Esri'
        });

        // Capas predefinidas
        const layers = {
            'Tumaco': {
                file: 'Tumaco.geojson',
                color: '#FFA500'
            },
            // Agrega aquí más capas predefinidas
        };

        // Control de capas
        const layerControl = L.control.layers({
            'Google Streets': googleStreets,
            'Satélite Esri': esriSatellite
        }, {}, { collapsed: false }).addTo(map);

        // Carga capas predefinidas
        Object.entries(layers).forEach(([name, config]) => {
            fetch(config.file)
                .then(res => res.json())
                .then(data => {
                    const layer = L.geoJSON(data, {
                        style: { color: config.color }
                    }).addTo(map);
                    
                    layerControl.addOverlay(layer, name);
                    createLayerCheckbox(name, config.color);
                });
        });

        // Carga de archivos
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function() {
                try {
                    const format = file.name.split('.').pop().toLowerCase();
                    let layer;
                    
                    if (format === 'kml') {
                        layer = omnivore.kml.parse(reader.result);
                    } else {
                        layer = L.geoJSON(JSON.parse(reader.result));
                    }

                    const color = '#' + Math.floor(Math.random()*16777215).toString(16);
                    const name = file.name.split('.')[0];
                    
                    layer.setStyle({ color: color });
                    layer.addTo(map);
                    
                    layerControl.addOverlay(layer, name);
                    createLayerCheckbox(name, color);
                    
                } catch (error) {
                    alert('Error al cargar el archivo');
                    console.error(error);
                }
            };

            reader.readAsText(file);
        });

        // Crear checkbox para capas
        function createLayerCheckbox(name, color) {
            const div = document.createElement('div');
            div.className = 'layer-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = true;
            
            const label = document.createElement('label');
            label.textContent = name;
            label.style.marginLeft = '5px';
            
            const colorBox = document.createElement('div');
            colorBox.className = 'color-box';
            colorBox.style.backgroundColor = color;
            
            div.appendChild(checkbox);
            div.appendChild(label);
            div.appendChild(colorBox);
            
            document.getElementById('layers-list').appendChild(div);
        }
    </script>
</body>
</html>
