<!DOCTYPE html>
<html>
<head>
<title>Geoportal Interactivo - Tumaco</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.72.0/L.Control.Locate.min.css"/>
<style>
html, body, #map {
height: 100%;
margin: 0;
}
.leaflet-control-attribution {
position: absolute;
bottom: 0;
left: 0;
padding: 0 5px;
font-size: 14px;
background: rgba(255,255,255,0.8);
font-weight: bold;
}
#title {
position: absolute;
top: 10px;
left: 50%;
transform: translateX(-50%);
z-index: 401;
background: rgba(255,255,255,0.7);
padding: 5px;
font-size: 18px;
font-weight: bold;
}
#legend {
position: absolute;
bottom: 10px;
left: 10px;
z-index: 401;
background: rgba(255,255,255,0.8);
padding: 10px;
border-radius: 5px;
}
.legend-item {
display: flex;
align-items: center;
margin-bottom: 5px;
}
.legend-color {
width: 20px;
height: 20px;
margin-right: 5px;
border-radius: 50%;
}
#search-container {
position: absolute;
top: 10px;
right: 10px;
z-index: 401;
background: rgba(255,255,255,0.8);
padding: 5px;
border-radius: 5px;
}
#export-container {
position: absolute;
top: 10px;
right: 180px;
z-index: 401;
background: rgba(255,255,255,0.8);
padding: 5px;
border-radius: 5px;
}
#export-btn {
padding: 5px 10px;
background: #4CAF50;
color: white;
border: none;
border-radius: 3px;
cursor: pointer;
}
/* Ajuste para créditos */
.leaflet-control-attribution {
  background: transparent !important;
  font-size: 12px !important;
}
</style>
</head>
<body>
<div id="title">CORPORACIÓN BIOCOMERCIO SOSTENIBLE</div>
<div id="map"></div>
<div id="legend"></div>
<div id="search-container">
<input type="text" id="search-input" placeholder="Buscar...">
</div>
<div id="export-container">
<button id="export-btn">Exportar GeoJSON</button>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.72.0/L.Control.Locate.min.js"></script>
<script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>

<script>
var map = L.map('map', {
  layers: [] // Iniciamos sin capas base
}).setView([1.795, -78.825], 10);

// Capas base
var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
  maxZoom: 20,
  subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
  attribution: 'Map data &copy; <a href="https://www.google.com/maps/">Google Maps</a>'
});

var esriSatellite = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
});

// Capas existentes
var capas = {
  "Cabo Manglar": L.geoJSON(null, { style: { color: 'red' } }),
  "Consejo Las Varas": L.geoJSON(null, { style: { color: 'blue' } }),
  "Cor Mangle": L.geoJSON(null, { style: { color: 'green' } }),
  "Mangle Consejo": L.geoJSON(null, { style: { color: 'purple' } }),
  "Tumaco": L.geoJSON(null, { style: { color: 'orange' } }),
  "Constricciones": L.geoJSON(null, { style: { color: 'brown' } })
};

// Cargamos las capas existentes
Object.keys(capas).forEach(nombre => {
  fetch(nombre.replace(/ /g, '_').toLowerCase() + '.geojson')
    .then(response => response.json())
    .then(data => {
      capas[nombre].addData(data);
      // Agregamos la capa al mapa solo si hay datos
      if(data.features.length > 0) {
        capas[nombre].addTo(map);
      }
    });
});

// Capa para elementos dibujados
var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

// Control de capas
L.control.layers({
  "Google Streets": googleStreets,
  "Esri Satellite": esriSatellite
}, {
  ...capas,
  "Elementos dibujados": drawnItems
}, { collapsed: false }).addTo(map);

// Resto del código (geolocalización, dibujo, exportación, etc.)
// ... [El resto del código JavaScript permanece igual] ...

// Créditos (agregado al final para asegurar prioridad)
L.control.attribution({ 
  prefix: '<a href="https://github.com/DiegoCastanoSIG" target="_blank">Elaborado por Diego Castaño, Esp. SIG</a>',
  position: 'bottomright'
}).addTo(map);

// Aseguramos que el control de capas no tape los créditos
map.on('overlayadd', function(e) {
  if(e.name === 'Elementos dibujados') {
    drawnItems.eachLayer(layer => map.addLayer(layer));
  }
});
</script>
</body>
</html>
